<script>
  export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    const to = url.searchParams.get("to");
    const msg = url.searchParams.get("msg");

    if (!to || !msg) {
      return new Response("Missing parameters", { status: 400 });
    }

    // Keys
    const accountSid = AC7456836e66cccd305337ab18844c7ee1;
    const authToken = f5c6e16c0d1312c20c552664106c3f6c;
    const fromNumber = +18333171299;

    const twilioUrl = `https://api.twilio.com/2010-04-01/Accounts/${accountSid}/Messages.json`;

    const body = new URLSearchParams({
      To: to,
      From: fromNumber,
      Body: msg,
    });

    const auth = btoa(`${accountSid}:${authToken}`);

    const res = await fetch(twilioUrl, {
      method: "POST",
      headers: {
        Authorization: `Basic ${auth}`,
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body,
    });

    const text = await res.text();
    return new Response(text, { 
      status: res.status,
      headers: { "Access-Control-Allow-Origin": "*" }  // Optional: for browser testing
    });
  },
};
</script>
