---
import MainLayout from '../../layouts/MainLayout.astro';

interface ProjectDefinition {
  title: string;
  summary: string;
  tags: string[];
  year?: string | string[];
  featured?: boolean;
  url?: string;
  repo?: string;
  link?: {
    label: string;
    href: string;
  };
  projectPage?: string;
}

function buildGitHubUrl(repo?: string): string | undefined {
  if (!repo) return undefined;
  const cleaned = repo.trim();
  if (!cleaned) return undefined;
  if (cleaned.startsWith('http://') || cleaned.startsWith('https://')) {
    return cleaned;
  }
  return `https://github.com/${cleaned.replace(/^\//, '')}`;
}

function determineProjectLink(proj: ProjectDefinition): { url: string; isExternal: boolean } | null {
  if (proj.projectPage) {
    return {
      url: `/projects/${proj.projectPage}`,
      isExternal: false,
    };
  } else if (proj.link) {
    return {
      url: proj.link.href,
      isExternal: true,
    };
  } else {
    const repoLink = buildGitHubUrl(proj.repo);
    if (repoLink) {
      return {
        url: repoLink,
        isExternal: true,
      };
    }
  }
  return null;
}

const projectsList: ProjectDefinition[] = [
  {
    title: 'InfantGuard',
    summary:
      'Infant Guard is a fully integrated, Arduino-driven safety platform engineered to detect forgotten infants in vehicles and escalate alerts before temperatures reach life-threatening levels.',
    tags: ['Arduino', 'IoT', 'Safety', 'Hardware'],
    year: ['2025'],
    featured: true,
    projectPage: 'infantguard',
  },
  {
    title: 'Personal Portfolio Website',
    summary:
      'This website! Built with Astro and Tailwind CSS, it showcases my projects, skills, and contact information in a clean and modern design.',
    tags: ['Astro', 'Tailwind CSS', 'Portfolio'],
    year: ['2025'],
    featured: false,
    repo: 'psavvas/personal-portfolio-website',
  },
  {
    title: 'Daily Digest',
    summary:
      'DailyDigest is a Python application that automatically generates and sends a daily summary email containing your upcoming calendar events, reminders, local weather, and a motivational quote.',
    tags: ['Productivity', 'Coding', 'Python Scripts'],
    year: ['2025'],
    featured: true,
    repo: 'psavvas/daily-digest',
  },
  {
    title: 'MoleMini',
    summary:
      'Mole Mini is an all-in-one chemistry computer helping with complex calculations and conversions, created by myself and Connor Denihan in 2025.',
    tags: ['Microcomputer', 'Chemistry', 'Education'],
    year: ['2025'],
    featured: false,
    repo: 'cdenihan/mole-day-project',
  },
  {
    title: 'Notion Templates',
    summary:
      'A series of high-quality Notion templates designed to enhance productivity and organization, free for personal and professional use. Ranging from team hubs to personal planners.',
    tags: ['Productivity', 'Lifestyle', 'Notion'],
    year: ['2025'],
    featured: true,
    projectPage: 'notion-templates',
  },
  {
    title: '3D Printing for Shock Absorption',
    summary:
      'A 1st place Science Fair project investigating how different infills could affect the shock absorption properties of different objects, through research and custom infills.',
    tags: ['3D Printing', 'Science Fair', 'Research'],
    year: ['2024'],
    featured: true,
    projectPage: '3d-printing-shock-absorption',
  },
  {
    title: 'Aircraft Cabin Redesign',
    summary:
      'A recreational project, aiming to redesign aircraft cabin and airline seating for improved comfort and functionality, through 3D modeling.',
    tags: ['3D Printing', 'CAD', 'Aviation'],
    year: ['2024'],
    featured: false,
    projectPage: 'aircraft-cabin-redesign',
  },
];

const githubProfile = 'https://github.com/psavvas';
const thingiverseProfile = 'https://www.thingiverse.com/psavvas';

function formatYearDisplay(yearData?: string | string[]): string | undefined {
  const yearArray = Array.isArray(yearData)
    ? yearData
    : yearData
    ? [yearData]
    : [];
  const yearNumbers = yearArray
    .map((y) => Number(String(y).trim()))
    .filter((n) => !Number.isNaN(n));
  
  if (yearNumbers.length === 1) {
    return String(yearNumbers[0]);
  } else if (yearNumbers.length > 1) {
    const minYear = Math.min(...yearNumbers);
    const maxYear = Math.max(...yearNumbers);
    return `${minYear}–${maxYear}`;
  }
  return undefined;
}
---

<MainLayout 
  pageTitle="Projects" 
  pageDescription="Projects by Paul Savvas — a selection of work across software, hardware, and 3D design."
>
  <div class="min-h-screen bg-white font-sans dark:bg-neutral-950 transition-colors">
    <main class="mx-auto w-full max-w-6xl bg-white px-6 py-16 dark:bg-neutral-950 sm:px-16 sm:py-24 animate-fade-in">
      <header class="max-w-3xl animate-fade-in-up">
        <p class="text-sm font-medium uppercase tracking-wider text-neutral-600 dark:text-neutral-400">
          Projects
        </p>
        <h1 class="mt-3 text-4xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100 sm:text-5xl">
          Simple. Practical. Impactful.
        </h1>
          <p class="mt-6 text-base leading-7 text-neutral-700 dark:text-neutral-300">
          A growing collection of software, hardware, and 3D design work. I'm drawn to projects that can have a positive impact on the world—whether in small, everyday ways or larger initiatives—while staying grounded in real constraints and performing well in practice.
          </p>

        <div class="mt-8">
          <a
            class="inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift"
            href={githubProfile}
            target="_blank"
            rel="noopener noreferrer"
          >
            Browse all code projects on GitHub
          </a>
          <a
            class="ml-4 inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift"
            href={thingiverseProfile}
            target="_blank"
            rel="noopener noreferrer"
          >
            Browse all 3D design projects on Thingiverse
          </a>
        </div>
      </header>

      <section class="mt-14">
        <div class="animate-fade-in-up">
          <h2 class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100">
            Featured Projects
          </h2>
          <p class="mt-3 max-w-3xl text-sm leading-6 text-neutral-600 dark:text-neutral-400">
            A few of my most impactful, noteworthy or favorite projects.
          </p>
        </div>

        <div class="mt-8 grid gap-6 md:grid-cols-2">
          {projectsList
            .filter((p) => p.featured !== false)
            .map((proj) => {
            const linkInfo = determineProjectLink(proj);
            const displayYear = formatYearDisplay(proj.year);

            return (
              <article class="rounded-xl border border-neutral-200 bg-white p-6 dark:border-neutral-800 dark:bg-neutral-950 hover-lift animate-fade-in-up">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">
                    {proj.title}
                  </h3>
                  {displayYear && (
                    <span class="inline-flex items-center rounded-full border border-neutral-200 px-3 py-1 text-xs font-medium text-neutral-700 dark:border-neutral-800 dark:text-neutral-300">
                      {displayYear}
                    </span>
                  )}
                </div>

                <p class="mt-3 text-sm leading-6 text-neutral-700 dark:text-neutral-300">
                  {proj.summary}
                </p>

                <div class="mt-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                  <div class="flex flex-wrap gap-2">
                    {proj.tags.map((tag) => (
                      <span class="inline-flex items-center rounded-full bg-neutral-100 px-3 py-1 text-xs font-medium text-neutral-700 dark:bg-neutral-900 dark:text-neutral-300">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div class="flex flex-wrap gap-3 sm:justify-end">
                    {linkInfo && (
                      <a
                        class="inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift"
                        href={linkInfo.url}
                        {...(linkInfo.isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
                      >
                        Learn More
                      </a>
                    )}
                  </div>
                </div>
              </article>
            );
            })}
        </div>
      </section>

      <section class="mt-14 max-w-3xl animate-fade-in-up animation-delay-300">
        <h2 class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100">
          How I evaluate a project
        </h2>
        <ul class="mt-4 list-disc space-y-2 pl-5 text-base leading-7 text-neutral-700 dark:text-neutral-300">
          <li>
            Clarity: can someone understand the goal and approach quickly?
          </li>
          <li>
            Constraints: does it work within real limits (time, materials,
            performance)?
          </li>
          <li>Results: are outcomes measurable, testable, and repeatable?</li>
          <li>Iteration: what changed after the first version shipped?</li>
        </ul>
      </section>

      <section class="mt-14">
        <div class="animate-fade-in-up">
          <h2 class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100">
            All projects
          </h2>
          <p class="mt-3 max-w-3xl text-sm leading-6 text-neutral-600 dark:text-neutral-400">
            A complete list of projects with links and quick context.
          </p>
        </div>

        <ul class="mt-6 rounded-xl border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-950 divide-y divide-neutral-200 dark:divide-neutral-800">
          {projectsList.map((proj) => {
            const linkInfo = determineProjectLink(proj);
            const displayYear = formatYearDisplay(proj.year);

            return (
              <li class="p-4 sm:p-5 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between animate-fade-in-up">
                <div>
                  <div class="flex items-center gap-3">
                    <span class="text-sm font-medium text-neutral-900 dark:text-neutral-100">
                      {proj.title}
                    </span>
                    {displayYear && (
                      <span class="inline-flex items-center rounded-full border border-neutral-200 px-2.5 py-0.5 text-[11px] font-medium text-neutral-700 dark:border-neutral-800 dark:text-neutral-300">
                        {displayYear}
                      </span>
                    )}
                  </div>
                  <p class="mt-1 text-sm leading-6 text-neutral-700 dark:text-neutral-300 line-clamp-2">
                    {proj.summary}
                  </p>
                  <div class="mt-2 flex flex-wrap gap-2">
                    {proj.tags.map((tag) => (
                      <span class="inline-flex items-center rounded-full bg-neutral-100 px-2.5 py-0.5 text-[11px] font-medium text-neutral-700 dark:bg-neutral-900 dark:text-neutral-300">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>

                <div class="flex gap-3 sm:ml-6">
                  {linkInfo && (
                    <a
                      class="inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-3 py-1.5 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift"
                      href={linkInfo.url}
                      {...(linkInfo.isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
                    >
                      View
                    </a>
                  )}
                </div>
              </li>
            );
          })}
        </ul>
      </section>
    </main>
  </div>
</MainLayout>
