---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { catalogue, type CatalogueEntry } from '../../data/site';

const pageTitle = 'Projects | Paul Savvas';
const pageDesc =
  'Projects by Paul Savvas — a selection of work across software, hardware, and 3D design.';

const ghProfileUrl = 'https://github.com/psavvas';
const tvProfileUrl = 'https://www.thingiverse.com/psavvas';

/* ── Helper: build a "learn more" destination for a catalogue entry ── */
function resolveDestination(
  item: CatalogueEntry
): { url: string; external: boolean } | null {
  if (item.projectPage) {
    return { url: `/projects/${item.projectPage}`, external: false };
  }
  if (item.link) {
    return { url: item.link.href, external: true };
  }
  if (item.repo) {
    const r = item.repo.trim();
    const repoUrl = r.startsWith('http')
      ? r
      : `https://github.com/${r.replace(/^\//, '')}`;
    return { url: repoUrl, external: true };
  }
  return null;
}

/* ── Helper: format year array into a display label ── */
function formatYear(years?: string[]): string | undefined {
  if (!years || years.length === 0) return undefined;
  const nums = years
    .map((y) => Number(y.trim()))
    .filter((n) => !Number.isNaN(n));
  if (nums.length === 0) return undefined;
  if (nums.length === 1) return String(nums[0]);
  return `${Math.min(...nums)}–${Math.max(...nums)}`;
}

const featuredItems = catalogue.filter((p) => p.featured !== false);

const cardCls =
  'rounded-xl border border-neutral-200 bg-white p-6 dark:border-neutral-800 dark:bg-neutral-950 hover-lift animate-fade-in-up';
const tagCls =
  'inline-flex items-center rounded-full bg-neutral-100 px-3 py-1 text-xs font-medium text-neutral-700 dark:bg-neutral-900 dark:text-neutral-300';
const actionCls =
  'inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift';
---

<BaseLayout title={pageTitle} description={pageDesc}>
  <div
    class="min-h-screen bg-white font-sans dark:bg-neutral-950 transition-colors"
  >
    <main
      class="mx-auto w-full max-w-6xl bg-white px-6 py-16 dark:bg-neutral-950 sm:px-16 sm:py-24 animate-fade-in"
    >
      <!-- Header -->
      <header class="max-w-3xl animate-fade-in-up">
        <p
          class="text-sm font-medium uppercase tracking-wider text-neutral-600 dark:text-neutral-400"
        >
          Projects
        </p>
        <h1
          class="mt-3 text-4xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100 sm:text-5xl"
        >
          Simple. Practical. Impactful.
        </h1>
        <p
          class="mt-6 text-base leading-7 text-neutral-700 dark:text-neutral-300"
        >
          A growing collection of software, hardware, and 3D design work. I'm
          drawn to projects that can have a positive impact on the world—whether
          in small, everyday ways or larger initiatives—while staying grounded
          in real constraints and performing well in practice.
        </p>

        <div class="mt-8">
          <a
            class={actionCls}
            href={ghProfileUrl}
            target="_blank"
            rel="noopener noreferrer"
          >
            Browse all code projects on GitHub
          </a>
          <a
            class={`ml-4 ${actionCls}`}
            href={tvProfileUrl}
            target="_blank"
            rel="noopener noreferrer"
          >
            Browse all 3D design projects on Thingiverse
          </a>
        </div>
      </header>

      <!-- Featured Projects -->
      <section class="mt-14">
        <div class="animate-fade-in-up">
          <h2
            class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100"
          >
            Featured Projects
          </h2>
          <p
            class="mt-3 max-w-3xl text-sm leading-6 text-neutral-600 dark:text-neutral-400"
          >
            A few of my most impactful, noteworthy or favorite projects.
          </p>
        </div>

        <div class="mt-8 grid gap-6 md:grid-cols-2">
          {
            featuredItems.map((proj) => {
              const dest = resolveDestination(proj);
              const yr = formatYear(proj.year);
              return (
                <article class={cardCls}>
                  <div class="flex flex-wrap items-center justify-between gap-3">
                    <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">
                      {proj.title}
                    </h3>
                    {yr && (
                      <span class="inline-flex items-center rounded-full border border-neutral-200 px-3 py-1 text-xs font-medium text-neutral-700 dark:border-neutral-800 dark:text-neutral-300">
                        {yr}
                      </span>
                    )}
                  </div>
                  <p class="mt-3 text-sm leading-6 text-neutral-700 dark:text-neutral-300">
                    {proj.summary}
                  </p>
                  <div class="mt-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex flex-wrap gap-2">
                      {proj.tags.map((t) => (
                        <span class={tagCls}>{t}</span>
                      ))}
                    </div>
                    <div class="flex flex-wrap gap-3 sm:justify-end">
                      {dest && (
                        <a
                          class={actionCls}
                          href={dest.url}
                          {...(dest.external
                            ? { target: '_blank', rel: 'noopener noreferrer' }
                            : {})}
                        >
                          Learn More
                        </a>
                      )}
                    </div>
                  </div>
                </article>
              );
            })
          }
        </div>
      </section>

      <!-- Evaluation criteria -->
      <section class="mt-14 max-w-3xl animate-fade-in-up animation-delay-300">
        <h2
          class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100"
        >
          How I evaluate a project
        </h2>
        <ul
          class="mt-4 list-disc space-y-2 pl-5 text-base leading-7 text-neutral-700 dark:text-neutral-300"
        >
          <li>
            Clarity: can someone understand the goal and approach quickly?
          </li>
          <li>
            Constraints: does it work within real limits (time, materials,
            performance)?
          </li>
          <li>Results: are outcomes measurable, testable, and repeatable?</li>
          <li>Iteration: what changed after the first version shipped?</li>
        </ul>
      </section>

      <!-- All projects list -->
      <section class="mt-14">
        <div class="animate-fade-in-up">
          <h2
            class="text-xl font-semibold tracking-tight text-neutral-900 dark:text-neutral-100"
          >
            All projects
          </h2>
          <p
            class="mt-3 max-w-3xl text-sm leading-6 text-neutral-600 dark:text-neutral-400"
          >
            A complete list of projects with links and quick context.
          </p>
        </div>

        <ul
          class="mt-6 rounded-xl border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-950 divide-y divide-neutral-200 dark:divide-neutral-800"
        >
          {
            catalogue.map((proj) => {
              const dest = resolveDestination(proj);
              const yr = formatYear(proj.year);
              const smallTagCls =
                'inline-flex items-center rounded-full bg-neutral-100 px-2.5 py-0.5 text-[11px] font-medium text-neutral-700 dark:bg-neutral-900 dark:text-neutral-300';
              return (
                <li class="p-4 sm:p-5 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between animate-fade-in-up">
                  <div>
                    <div class="flex items-center gap-3">
                      <span class="text-sm font-medium text-neutral-900 dark:text-neutral-100">
                        {proj.title}
                      </span>
                      {yr && (
                        <span class="inline-flex items-center rounded-full border border-neutral-200 px-2.5 py-0.5 text-[11px] font-medium text-neutral-700 dark:border-neutral-800 dark:text-neutral-300">
                          {yr}
                        </span>
                      )}
                    </div>
                    <p class="mt-1 text-sm leading-6 text-neutral-700 dark:text-neutral-300 line-clamp-2">
                      {proj.summary}
                    </p>
                    <div class="mt-2 flex flex-wrap gap-2">
                      {proj.tags.map((t) => (
                        <span class={smallTagCls}>{t}</span>
                      ))}
                    </div>
                  </div>
                  <div class="flex gap-3 sm:ml-6">
                    {dest && (
                      <a
                        class="inline-flex items-center justify-center rounded-md border border-neutral-200 bg-white px-3 py-1.5 text-sm font-medium text-neutral-900 transition-colors hover:bg-neutral-50 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-100 dark:hover:bg-neutral-900 hover-lift"
                        href={dest.url}
                        {...(dest.external
                          ? { target: '_blank', rel: 'noopener noreferrer' }
                          : {})}
                      >
                        View
                      </a>
                    )}
                  </div>
                </li>
              );
            })
          }
        </ul>
      </section>
    </main>
  </div>
</BaseLayout>
